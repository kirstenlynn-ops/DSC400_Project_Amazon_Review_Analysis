#static_dashboard.py

#Add
import os
import pandas as pd
import plotly.express as px
import plotly.io as pio

#Load Dataset
csv_path = os.path.join(os.getcwd(), "Amazon_FE_Dataset.csv")
df_master = pd.read_csv(csv_path)

#KPIs
avg_rating = df_master['overall'].mean().round(2)
most_reviewed_product = df_master['asin'].value_counts().idxmax()
most_reviews_count = df_master['asin'].value_counts().max()
avg_sentiment = df_master['sentiment_polarity'].mean().round(2)
top_reviewer = df_master['reviewerID'].value_counts().idxmax()
top_reviewer_count = df_master['reviewerID'].value_counts().max()

#Colors
amazon_orange = "#FF9900"
amazon_navy = "#232F3E"
amazon_gray = "#F5F5F5"

#Figures/Visuals

#Customer Rating Distribution
rating_counts = df_master["overall"].value_counts().sort_index()
rating_percent = rating_counts / rating_counts.sum() * 100
fig1 = px.bar(
    x=rating_counts.index, y=rating_counts.values,
    text=[f"{p:.1f}%" for p in rating_percent],
    labels={"x": "Star Rating", "y": "Number of Reviews"},
    title="Customer Rating Distribution"
)
fig1.update_traces(marker_color=amazon_orange, textposition="outside")
fig1.update_layout(plot_bgcolor=amazon_gray, paper_bgcolor="white", title_font_color=amazon_navy, height=500)

#Review Length by Rating
fig2 = px.box(df_master, x="overall", y="review_length", points="outliers",
              labels={"overall": "Star Rating", "review_length": "Review Length (chars)"},
              title="Review Length by Rating")
fig2.update_traces(marker_color=amazon_orange, line_color=amazon_navy)
fig2.update_layout(plot_bgcolor=amazon_gray, paper_bgcolor="white", title_font_color=amazon_navy, height=500)

#Verified vs Non-Verified Reviews
verified_counts = df_master["verified"].value_counts()
fig4 = px.bar(x=["Verified Purchase", "Non-Verified"], y=verified_counts.values,
              text=[f"{v:,}" for v in verified_counts.values],
              labels={"x": "Review Type", "y": "Number of Reviews"},
              title="Verified vs Non-Verified Reviews")
fig4.update_traces(marker_color=[amazon_orange, "#4A4A4A"], textposition="outside")
fig4.update_layout(plot_bgcolor=amazon_gray, paper_bgcolor="white", title_font_color=amazon_navy, height=500)

#Reviews With vs Without Images
image_counts = df_master["has_image"].value_counts()
fig5 = px.pie(names=["No Image", "Has Image"], values=image_counts.values,
              title="Reviews With vs Without Images", hole=0.45)
fig5.update_traces(marker=dict(colors=[amazon_navy, amazon_orange]))

#Review Activity Over Time
reviews_year = df_master[df_master["review_year"] >= 2004].groupby("review_year").size().reset_index(name="num_reviews")
fig6 = px.line(reviews_year, x="review_year", y="num_reviews", markers=True,
               labels={"review_year": "Year", "num_reviews": "Number of Reviews"},
               title="Review Activity Over Time (2004–Present)")
fig6.update_traces(line=dict(color=amazon_orange))
fig6.update_layout(height=500)

#Top 5 Most Reviewed Products
top_products = df_master["asin"].value_counts().head(5).reset_index()
top_products.columns = ["Product (ASIN)", "Review Count"]
colors = [amazon_orange] + [amazon_navy]*(len(top_products)-1)
fig7 = px.bar(top_products, x="Review Count", y="Product (ASIN)", orientation="h", text="Review Count")
fig7.update_traces(marker_color=colors, textposition="outside")
fig7.update_layout(height=500)

#Top 5 Most Active Reviewers
top_reviewers = df_master["reviewerID"].value_counts().head(5).reset_index()
top_reviewers.columns = ["Reviewer ID", "Review Count"]
colors = [amazon_orange] + [amazon_navy]*(len(top_reviewers)-1)
fig8 = px.bar(top_reviewers, x="Review Count", y="Reviewer ID", orientation="h", text="Review Count")
fig8.update_traces(marker_color=colors, textposition="outside")
fig8.update_layout(height=500)

#Generate Static HTML
html_content = f"""
<html>
<head>
    <title>Amazon Reviews Dashboard</title>
</head>
<body style="font-family:sans-serif; margin:20px; background-color:#F2F2F2;">
    <h1 style="color:{amazon_orange}; text-align:center;">Amazon Reviews Dashboard (Static)</h1>
    <h4 style="text-align:center; color:{amazon_navy};">Created by: Kirsten Lynn – DSC 400</h4>
    <hr>

    <h2>Key Performance Indicators (KPIs)</h2>
    <div style="display:flex; justify-content:space-around; flex-wrap:wrap; margin-bottom:40px;">
        <div style="background-color:{amazon_orange}; color:white; padding:20px; border-radius:10px; width:200px; text-align:center;">
            <h3>{avg_rating}</h3>
            <p>Average Rating</p>
        </div>
        <div style="background-color:{amazon_navy}; color:white; padding:20px; border-radius:10px; width:200px; text-align:center;">
            <h3>{most_reviewed_product}</h3>
            <p>Most Reviewed Product ({most_reviews_count} reviews)</p>
        </div>
        <div style="background-color:{amazon_orange}; color:white; padding:20px; border-radius:10px; width:200px; text-align:center;">
            <h3>{avg_sentiment}</h3>
            <p>Average Sentiment</p>
        </div>
        <div style="background-color:{amazon_navy}; color:white; padding:20px; border-radius:10px; width:200px; text-align:center;">
            <h3>{top_reviewer}</h3>
            <p>Top Reviewer ({top_reviewer_count} reviews)</p>
        </div>
    </div>

    <h2>Visualizations</h2>
    <div>{pio.to_html(fig1, full_html=False, include_plotlyjs='cdn')}</div>
    <div>{pio.to_html(fig2, full_html=False, include_plotlyjs=False)}</div>
    <div>{pio.to_html(fig4, full_html=False, include_plotlyjs=False)}</div>
    <div>{pio.to_html(fig5, full_html=False, include_plotlyjs=False)}</div>
    <div>{pio.to_html(fig6, full_html=False, include_plotlyjs=False)}</div>
    <div>{pio.to_html(fig7, full_html=False, include_plotlyjs=False)}</div>
    <div>{pio.to_html(fig8, full_html=False, include_plotlyjs=False)}</div>
</body>
</html>
"""

#Save HTML file
output_file = os.path.join(os.getcwd(), "Amazon_Reviews_Static_Dashboard.html")
with open(output_file, "w", encoding="utf-8") as f:
    f.write(html_content)

print(f"Static dashboard saved to: {output_file}")
